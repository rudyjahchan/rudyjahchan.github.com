<!doctype html>
<html>
  <head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# article: http://ogp.me/ns/article#">
    <meta charset="utf-8" />
    <meta name="keywords" content="Rudy Jahchan" />
    <meta name="author" content="Rudy Jahchan" />
    <meta http-equiv='X-UA-Compatible' content='IE=edge;chrome=1' />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="og:type" content="article">
<meta name="og:url" content="http://rudyjahchan.com/2013/02/12/sweeter-javascript-define-properties-to-add-syntactic-sugar/">
    <meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="Sweeter Javascript: Defining Properties to Add Syntactic Sugar">
<meta name="og:title" content="Sweeter Javascript: Defining Properties to Add Syntactic Sugar">
<meta name="twitter:site" content="@rudy">
<meta name="twitter:creator" content="@rudy">
<meta name="twitter:description" content="Originally posted on Carbon Five&#x27;s Blog.

Syntatic sugar makes for more human-readable code and, if done
correctly, provides for more flexibility. In the world of Node
many turn to Coffeescript to add...">
<meta name="og:description" content="Originally posted on Carbon Five&#x27;s Blog.

Syntatic sugar makes for more human-readable code and, if done
correctly, provides for more flexibility. In the world of Node
many turn to Coffeescript to add...">

    <title>Sweeter Javascript: Defining Properties to Add Syntactic Sugar - Rudy Jahchan</title>
    <link href="http://feeds.feedburner.com/rudyjahchan" rel="alternate" title="Rudy Jahchan" type="application/rss+xml" />
    <link href="/stylesheets/all.css" rel="stylesheet" />
    <script src="https://use.fontawesome.com/8d26a9e428.js"></script>
  </head>
  <body>
    <header id="main" class="navbar">
      <div class="navbar__brand"><a href="/">Rudy Jahchan&nbsp;<span>&nbsp;</span></a></div>
      <nav id="main" class="site-nav">
        <ul class="links menu-activable">
          <li><a href="/blog/">Blog</a></li>
          <li><a href="/about/">About</a></li>
        </ul>
        <button id="menu-toggle" class="menu-activable">
          <span class="sr-only">Toggle navigation</span>
          <i class="fa fa-bars" aria-hidden="true"></i>
        </button>
      </nav>
    </header>
    <div id="faux-terminal">
      <div class="layer"></div>
      <div class="overlay"></div>
    </div>
    <div class="content">  <article>
      <header class="article-content">
	<h1><a href="/2013/02/12/sweeter-javascript-define-properties-to-add-syntactic-sugar/">Sweeter Javascript: Defining Properties to Add Syntactic Sugar</a></h1>
		<time datetime="2013-02-12 00:00">Published on Feb 12, 2013</time>
</header>

    <div class="article-content">  <p><em>Originally posted on <a href="http://blog.carbonfive.com/2013/02/12/sweeter-javascript-defining-properties-to-add-syntactic-sugar/">Carbon Five's Blog</a>.</em></p>

<p>Syntatic sugar makes for more human-readable code and, if done
correctly, provides for more flexibility. In the world of <a href="http://nodejs.org">Node</a>
many turn to <a href="http://coffeescript.org/">Coffeescript</a> to add that "sweetness",
but you can also achieve it with plain old Javascript. <a href="#tldr"><strong>TL;DR Â»</strong></a></p>

<h2 id="codeobjectdefinepropertycode"><code>Object.defineProperty</code></h2>

<p>It all comes down to using <a href="https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Object/defineProperty"><code>defineProperty</code></a> of the
<code>Object</code> class. Introduced as part of ECMAScript 5 and
implemented in Javascript 1.8.5 - which is supported by Node and most
major browsers - it allows you to add or modify
a property on an object by not just determining its value but its
entire behaviour.</p>

<pre><code>Object.defineProperty(obj, prop, descriptor)
</code></pre>

<p>The magic comes in the <code>descriptor</code> parameter. You can
directly set an initial <code>value</code> that will always be returned
by anyone using the property.  You can use other attributes in the
descriptor to make the property
<code>writable</code> (allowing new values assigned),
<code>configurable</code> (permit further changes), and
<code>enumerable</code> (returned during property enumeration).</p>

<p>But you can go beyond the simple retrieval and assignment of value to
properties by passing <em>functions</em> as the <code>get</code> and/or <code>set</code>
attributes in the descriptor.</p>

<p>Let's see how we can use it to add our sugar.</p>

<h2 id="an-example-read-only-attributes">An Example: Read-only Attributes</h2>

<p>Recently I published <a href="https://github.com/carbonfive/nock-vcr">nock-vcr</a>, a node module to deliver
the same functionaly of the Ruby gem <a href="https://github.com/vcr/vcr">VCR</a> but built atop the HTTP 
mocking framework <a href="https://github.com/flatiron/nock">nock</a>. VCR use the metaphor of "cassettes"
to record the HTTP interactions, with the interactions being written
out to a file named after the name given to the cassette. If a
cassette doesn't exist at the time of recording, it will be created.</p>

<p>For various reasons, we don't want to give users of the module
the ability to change the <code>name</code> of a <code>Cassette</code>
once an instance is created. This is accomplished by using
<code>Object.defineProperty</code> to explicity set the
<code>value</code>:</p>

<script src="https://gist.github.com/rudyjahchan/4753384.js?file=cassette.js"></script>

<p>Now when we instantiate an instance of <code>Cassette</code>, the string
passed in the construtor is returned by the <code>name</code> property.</p>

<script src="https://gist.github.com/rudyjahchan/4753384.js?file=cassette.sh"></script>

<p>More importantly, because we never set the <code>writable</code>
attribute in the descriptor to <code>true</code>, no one can assign 
a new value to the property:</p>

<script src="https://gist.github.com/rudyjahchan/4753384.js?file=cassette-read-only.sh"></script>

<h2 id="now-add-the-syntactic-sugar">Now Add the Syntactic Sugar</h2>

<p>At this point, we haven't done anything to "sweeten" the syntax. An
opportunity arises in implementing <code>exists</code>. If implemented
as a function, it would be used as follows:</p>

<pre><code>if(cassette.exists())
</code></pre>

<p>But wouldn't it be sweeter to do the following?</p>

<pre><code>if(cassette.exists)
</code></pre>

<p>In this case, we pass in a <code>get</code> function when defining
'exists' as a property. This function will be run every time the property is
referenced, ensuring it represents the current state of the cassette, but without
need of keeping tract with another attribute.</p>

<script src="https://gist.github.com/rudyjahchan/4753384.js?file=cassette-exists.js"></script>

<p>Now we can call <code>exists</code> without need of the parenthesis:</p>

<script src="https://gist.github.com/rudyjahchan/4753384.js?file=cassette-exists.sh"></script>

<p>A small, "sweet" victory.</p>

<h2 id="another-example-sweeter-tests">Another Example: Sweeter Tests</h2>

<p>The previous example did not really gain us much; what are a couple of
parenthesis in the larger scheme of things? A more useful example of this
technique and the benefits of syntactic sugar comes in writing out a 
<a href="http://chaijs.com/">chai</a>-like test framework called <code>rooibos</code>.</p>

<p>Let's begin by creating an <code>Assertion</code> "class", that accepts a
value we will be running our assertions against. We will also create and
export <code>expect</code> function as the only interface into our framework and
creating these assertions.</p>

<script src="https://gist.github.com/rudyjahchan/4753384.js?file=rooibos.js"></script>

<p>We can add two basic assertions; <code>truthy</code> which will
assert if the value is non-falsy and <code>empty</code>, which asserts
the value is has no characters if a string, no elements if an array, and
is non-null or undefined in all other cases.</p>

<script src="https://gist.github.com/rudyjahchan/4753384.js?file=rooibos-truthy-empty.js"></script>

<p>At this point, we can use the framework as follows:</p>

<script src="https://gist.github.com/rudyjahchan/4753384.js?file=rooibos-demo.sh"></script>

<p>We can sweeten this further with <code>to</code> and <code>be</code> properties that pass through the <code>Assertion</code> instance, doing nothing but enhancing readability.</p>

<script src="https://gist.github.com/rudyjahchan/4753384.js?file=rooibos-passthroughs.js"></script>

<p>So finally we can write our tests with the sweetest syntax of all:</p>

<script src="https://gist.github.com/rudyjahchan/4753384.js?file=rooibos-passthroughs.sh"></script>

<h2 id="a-nametldra-tldr"><a name="tldr"></a> tl;dr</h2>

<ul>
  <li><a href="https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Object/defineProperty"><code>Object.defineProperty</code></a> allows you add more behavior when a
property is assigned or referenced.</li>
  <li>By assigning a value with <code>Object.defineProperty</code> you make
it read-only.</li>
  <li>Assign a <code>get</code> function to a property to introduce
syntactic sugar like pass-throughs and queries for readability.</li>
</ul>


  <div id="disqus_thread"></div>
  <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR
       WEBPAGE * * */
  var disqus_shortname = 'rudyjahchan';
  var disqus_url = 'http://rudyjahchan.com/2013/02/12/sweeter-javascript-define-properties-to-add-syntactic-sugar/';

  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
   var dsq = document.createElement('script');
   dsq.type = 'text/javascript'; dsq.async =
   true;
   dsq.src = 'http://' +
   disqus_shortname +
   '.disqus.com/embed.js';
   (document.getElementsByTagName('head')[0]
    ||
    document.getElementsByTagName('body')[0]).appendChild(dsq);
   })();

(function () {
 var s = document.createElement('script'); s.async = true;
 s.type = 'text/javascript';
 s.src = 'http://' + disqus_shortname +
 '.disqus.com/count.js';
 (document.getElementsByTagName('HEAD')[0]
  ||
  document.getElementsByTagName('BODY')[0]).appendChild(s);
 }());

</script>
<noscript>Please enable
  JavaScript to view the
  <a
    href="http://disqus.com/?ref_noscript">comments
    powered by
    Disqus.</a></noscript>
<a
  href="http://disqus.com"
  class="dsq-brlink">blog
  comments powered by
  <span
    class="logo-disqus">Disqus</span></a>
</div>
  </article>
</div>
    <footer>
      <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png" /></a>&nbsp;
      <nav class="social">
        <a href="http://twitter.com/rudy"><i class="fa fa-twitter"></i></a>&nbsp;
        <a href="http://github.com/rudyjahchan/"><i class="fa fa-github"></i></a>&nbsp;
        <a href="http://instagram.com/rudyjahchan"><i class="fa fa-instagram"></i></a>&nbsp;
        <a href="http://feeds.feedburner.com/rudyjahchan"><i class="fa fa-rss"></i></a>
      </nav>
    </footer>
    <script src="/javascripts/all.js"></script>
  </body>
</html>

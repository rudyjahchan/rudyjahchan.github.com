<!doctype html>
<html>
  <head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# article: http://ogp.me/ns/article#">
    <meta charset="utf-8" />
    <meta name="keywords" content="Rudy Jahchan" />
    <meta name="author" content="Rudy Jahchan" />
    <meta http-equiv='X-UA-Compatible' content='IE=edge;chrome=1' />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="og:type" content="article">
<meta name="og:url" content="http://rudyjahchan.com/2012/01/23/monkey-patching-ios-with-objective-c-categories-part-i-simple-extensions-and-overrides/">
    <meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="Monkey-Patching iOS with Objective-C Categories Part I: Simple Extensions and Overrides">
<meta name="og:title" content="Monkey-Patching iOS with Objective-C Categories Part I: Simple Extensions and Overrides">
<meta name="twitter:site" content="@rudy">
<meta name="twitter:creator" content="@rudy">
<meta name="twitter:description" content="Originally posted on Carbon Five&#x27;s Blog.

Have you ever wanted to introduce new functionality to base classes in the iOS SDK? Or just make them work a little bit differently? In order to do so, you...">
<meta name="og:description" content="Originally posted on Carbon Five&#x27;s Blog.

Have you ever wanted to introduce new functionality to base classes in the iOS SDK? Or just make them work a little bit differently? In order to do so, you...">

    <title>Monkey-Patching iOS with Objective-C Categories Part I: Simple Extensions and Overrides - Rudy Jahchan</title>
    <link href="http://feeds.feedburner.com/rudyjahchan" rel="alternate" title="Rudy Jahchan" type="application/rss+xml" />
    <link href="/stylesheets/all.css" rel="stylesheet" />
    <script src="https://use.fontawesome.com/8d26a9e428.js"></script>
  </head>
  <body>
    <header id="main" class="navbar">
      <div class="navbar__brand"><a href="/">Rudy Jahchan&nbsp;<span>&nbsp;</span></a></div>
      <nav id="main" class="site-nav">
        <ul class="links menu-activable">
          <li><a href="/blog/">Blog</a></li>
          <li><a href="/about/">About</a></li>
        </ul>
        <button id="menu-toggle" class="menu-activable">
          <span class="sr-only">Toggle navigation</span>
          <i class="fa fa-bars" aria-hidden="true"></i>
        </button>
      </nav>
    </header>
    <div id="faux-terminal">
      <div class="layer"></div>
      <div class="overlay"></div>
    </div>
    <div class="content">  <article>
      <header class="article-content">
	<h1><a href="/2012/01/23/monkey-patching-ios-with-objective-c-categories-part-i-simple-extensions-and-overrides/">Monkey-Patching iOS with Objective-C Categories Part I: Simple Extensions and Overrides</a></h1>
		<time datetime="2012-01-23 00:00">Published on Jan 23, 2012</time>
</header>

    <div class="article-content">  <p><em>Originally posted on <a href="http://blog.carbonfive.com/2012/01/23/monkey-patching-ios-with-objective-c-categories-part-1-simple-extensions-and-overrides/">Carbon Five's Blog</a>.</em></p>

<p>Have you ever wanted to introduce new functionality to base classes in the iOS SDK? Or just make them work a <strong>little bit</strong> differently? In order to do so, you must enter the wild and dangerous world of monkey-patching.</p>

<p>Monkey-patching is extending or modifying the behavior of code at runtime <strong>without</strong> changing its original source code. You can monkey-patch any code, it doesn't matter whether it's your own code or not. This is distinctly different than traditional sub-classing because you are not creating a new class, instead, you are reopening an existing class and changing its behavior.</p>

<p>Monkey-patching is possible in Objective-C by using <a href="http://developer.apple.com/library/ios/#documentation/cocoa/conceptual/objectivec/chapters/occategories.html">categories</a>. In fact, the definition of a category practically matches that of monkey-patching:</p>

<p><code>"A category allows you to add methods to an existing classâeven to one for which you do not have the source."</code></p>

<p>In this series of posts, we'll use categories to add and change methods, to add new instance variables and properties, and introduce swizzling, a technique that allows us to extend and preserve existing functionality.<a href="#tldr"><strong>TL;DR »</strong></a></p>

<h2 id="category-basics">Category Basics</h2>

<p>To modify an existing class specify the category in both its interface and implementation definitions:</p>

<h4 id="interface-definition">Interface Definition</h4>

<script src="https://gist.github.com/1660134.js?file=AClassACategoryImplementation.h"></script>

<h4 id="implementation">Implementation</h4>

<script src="https://gist.github.com/1660134.js?file=AClassACategoryImplementation.m"></script>

<h2 id="adding-simple-methods">Adding Simple Methods</h2>

<p>The most basic usage of categories is to add a new method to an existing class.</p>

<p>Suppose in our application we want to output dates relative to the current time, e.g., "13 minutes ago", "4 hours ago", "just now", etc. Traditional object-oriented solutions would have us introducing a new class that either extends <code>NSDate</code> (e.g., creating a <code>RelativeDescriptionDate</code> subclass with a <code>timeAgoInWords</code> instance method) or is a standalone helper/utility class (e.g., <code>[NSDateHelper timeAgoInWordsFromDate:myDate]</code>).</p>

<p>But with categories, we can reopen the <code>NSDate</code> class and simply add a new instance method:</p>

<h4 id="nsdateformattingh">NSDate+Formatting.h</h4>

<script src="https://gist.github.com/1660134.js?file=NSDateFormatting.h"></script>

<h4 id="nsdateformattingm">NSDate+Formatting.m</h4>

<script src="https://gist.github.com/1660134.js?file=NSDateFormatting.m"></script>

<p>Now <strong>every</strong> <code>NSDate</code> object will have the new method available to it. The following code:</p>

<script src="https://gist.github.com/1660134.js?file=UsingNSDateFormatting.m"></script>

<p>Will print out the following on the console:</p>

<script src="https://gist.github.com/1660134.js?file=gistfile1.sh"></script>

<h2 id="the-dangers-of-simply-overriding-methods">The Dangers of Simply Overriding Methods</h2>

<p>We can take this a step further and instead of adding new behavior we'll override existing behavior. Continuing with our example, what if we wanted the default description of a <code>NSDate</code> object to include the time ago in words? We could simply do the following:</p>

<script src="https://gist.github.com/1660134.js?file=NSDateFormatting2.m"></script>

<p>However, this is <strong>strongly discouraged</strong> for two reasons.</p>

<ol>
  <li>Other frameworks may rely on the expected behavior of the original method. We now have to go through the trouble of re-implementing that behavior, in addition to the new functionality we wanted to introduce, or risk strange side effects and possibly even crashing out.</li>
  <li>If multiple categories implement the same method, the last one loaded wins! The load order is consistent within an application, but it's arbitrary, out of our hands, and fragile. For all we know, our implementation could itself be overwritten by an internal framework category!</li>
</ol>

<p>Because of these reasons, this blunt approach to overriding methods should only be used for the simplest of cases. Later in this series, we'll explore how swizzling allows us to override a method while preserving all implementations.</p>

<h2 id="including-your-monkey-patches">Including Your Monkey-Patches</h2>

<p>Categories are not automatically "picked up" in a project. Any code that relies on the behavior will need to <code>#import</code> the necessary header files:</p>

<script src="https://gist.github.com/1660134.js?file=EntryCell.m"></script>

<p>However, including the same set of headers over and over again is redundant. We should first create a single header file that imports all of our most frequently used categories:</p>

<script src="https://gist.github.com/1660134.js?file=Extensions.h"></script>

<p>We can then import this single header file into a prefix header that is added to all source files. XCode projects often have a <code>.pch</code> file in the Supporting Files group for this very purpose.</p>

<script src="https://gist.github.com/1660134.js?file=pc.h"></script>

<h2 id="next-up">Next Up</h2>

<p>While adding and overriding classes is straightforward, there is one very big caveat when using Categories; you <strong>cannot add new instance variables</strong> to a class. We'll take a look at working around this limitation in the next post.</p>

<h2 id="a-nametldra-tldr"><a name="tldr"></a> tl;dr</h2>

<ul>
  <li>Use Objective-C categories to add functionality to existing classes without subclassing.</li>
  <li>Avoid simple overrides with categories as it can cause problems with other frameworks.</li>
  <li>Use prefix headers to easily import your extensions.</li>
</ul>

  <div id="disqus_thread"></div>
  <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR
       WEBPAGE * * */
  var disqus_shortname = 'rudyjahchan';
  var disqus_url = 'http://rudyjahchan.com/2012/01/23/monkey-patching-ios-with-objective-c-categories-part-i-simple-extensions-and-overrides/';

  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
   var dsq = document.createElement('script');
   dsq.type = 'text/javascript'; dsq.async =
   true;
   dsq.src = 'http://' +
   disqus_shortname +
   '.disqus.com/embed.js';
   (document.getElementsByTagName('head')[0]
    ||
    document.getElementsByTagName('body')[0]).appendChild(dsq);
   })();

(function () {
 var s = document.createElement('script'); s.async = true;
 s.type = 'text/javascript';
 s.src = 'http://' + disqus_shortname +
 '.disqus.com/count.js';
 (document.getElementsByTagName('HEAD')[0]
  ||
  document.getElementsByTagName('BODY')[0]).appendChild(s);
 }());

</script>
<noscript>Please enable
  JavaScript to view the
  <a
    href="http://disqus.com/?ref_noscript">comments
    powered by
    Disqus.</a></noscript>
<a
  href="http://disqus.com"
  class="dsq-brlink">blog
  comments powered by
  <span
    class="logo-disqus">Disqus</span></a>
</div>
  </article>
</div>
    <footer>
      <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png" /></a>&nbsp;
      <nav class="social">
        <a href="http://twitter.com/rudy"><i class="fa fa-twitter"></i></a>&nbsp;
        <a href="http://github.com/rudyjahchan/"><i class="fa fa-github"></i></a>&nbsp;
        <a href="http://instagram.com/rudyjahchan"><i class="fa fa-instagram"></i></a>&nbsp;
        <a href="http://feeds.feedburner.com/rudyjahchan"><i class="fa fa-rss"></i></a>
      </nav>
    </footer>
    <script src="/javascripts/all.js"></script>
  </body>
</html>
